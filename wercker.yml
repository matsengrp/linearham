box: debian:stretch

build:
    steps:
        - install-packages:
            packages: autoconf bison libblas-dev build-essential cmake curl flex git libgsl-dev libncurses-dev python-pip scons libtool libyaml-cpp-dev libz-dev
        - pip-install:
            requirements_file: ""
            packages_list: "colored-traceback dendropy nestly numpy psutil pysam scipy biopython pandas seaborn pyyaml scikit-learn"
        - script:
            name: initialize git submodules
            code: |
                git submodule update --init --recursive
        - script:
            name: build
            code: scons --build-deps
        - script:
            name: test
            code: _build/test/test
        - script:
            name: deploy src
            code: cp -r Doxyfile src/ $WERCKER_OUTPUT_DIR

    after-steps:
        - slack-notifier:
            url: $SLACK_URL
            channel: bcell
            username: linearham build

deploy:
    steps:
        - install-packages:
            packages: curl doxygen git graphviz
        - script:
            name: build docs
            code: doxygen Doxyfile
        - ematsen/gh-pages:
            token: $GITHUB_TOKEN
            repo: matsengrp/linearham
            path: html

    after-steps:
        - slack-notifier:
            url: $SLACK_URL
            channel: bcell
            username: linearham build docs
